!function(t){"use strict";t.module("angular.autosuggest",[]).factory("httpi",["$http","$q","HttpiResource",function(t,e,n){function a(e){e.url=u(e.url,e.params,e.data,1!=e.keepTrailingSlash);var n=r(e),a=t(e);return a.abort=n,a}function r(t){if(t.timeout)return s;var n=function(){n.deferred.resolve()};return n.deferred=e.defer(),t.timeout=n.deferred.promise,n}function u(t,e,n,a){return e=e||{},n=n||{},t=t.replace(/(\(\s*|\s*\)|\s*\|\s*)/g,""),t=t.replace(/:([a-z]\w*)/gi,function(t,a){return i(n,e,a)||""}),t=t.replace(/(^|[^:])[\/]{2,}/g,"$1/"),a&&(t=t.replace(/\/+$/i,"")),t}function s(){console&&console.warn&&console.warn("This request cannot be aborted because the [timeout] property was already being used.")}function i(t,e,n,a){for(var r=Array.prototype.slice.call(arguments),a=r.pop(),u=null;u=r.shift();)if(u.hasOwnProperty(a))return o(u,a)}function o(t,e){var n=t[e];return delete t[e],n}return a.resource=function(t){return new n(a,t)},a}]).factory("HttpiResource",function(){function t(t,e){return this._http=t,this._url=e,this._keepTrailingSlash=!1,this}return t.prototype={constructor:t,"delete":function(t){return this._makeHttpRequest("delete",t)},get:function(t){return this._makeHttpRequest("get",t)},head:function(t){return this._makeHttpRequest("head",t)},jsonp:function(t){return this._makeHttpRequest("jsonp",t)},post:function(t){return this._makeHttpRequest("post",t)},put:function(t){return this._makeHttpRequest("put",t)},setKeepTrailingSlash:function(t){return this._keepTrailingSlash=t,this},_makeHttpRequest:function(t,e){return e=e||{},e.method=t,e.url=this._url,e.hasOwnProperty("keepTrailingSlash")||(e.keepTrailingSlash=this._keepTrailingSlash),"jsonp"===e.method&&this._paramJsonpCallback(e),this._http(e)},_paramJsonpCallback:function(t){var e="JSON_CALLBACK";if(-1===this._url.indexOf(e)){if(t.params){for(var n in t.params)if(t.params.hasOwnProperty(n)&&t.params[n]===e)return}else t.params={};t.params.callback=e}}},t}).directive("autoSuggestItem",function(){return{require:"^autoSuggest",link:function(t,e,n,a){e.attr("tabindex",0),a.updateTotalItems(t.$index,t.$eval(n.autoSuggestItem)),e.bind("click",function(){a.activateIndex(t.$index)})}}}).directive("autoSuggest",["httpi",function(t){return{restrict:"E",replace:!0,transclude:!0,template:'<div class="angular-autosuggest"><div ng-transclude></div></div>',controller:["$scope",function(t){this.updateTotalItems=function(e,n){t.autoSuggestItemsCount++,t.autoSuggestItemsHash[e]=n},this.activateIndex=function(e){t.updateActiveIndex(e),t.callback()}}],link:function(e,n,a){e.response={},e.autoSuggestItemsCount=0,e.autoSuggestItemsHash={},e.activeIndex=0,e.search={},e.search.status="idle";var r=null;e.callback=function(){var t=e.autoSuggestItemsHash[e.activeIndex],n=a.searchSelectCallback;"function"==typeof e[n]?e[n](t):console.warn("autoSuggest : ","searchSelectCallback is not a valid function")},e.updateActiveIndex=function(t){e.$evalAsync(function(){e.activeIndex=t})},e.makeHttpRequest=function(){e.autoSuggestItemsCount=0,e.search.status="initialized",e.autoSuggestItemsHash={},e.activeIndex=0;var n={};r&&r.abort(),n[a.searchQueryParameter]=e.search.query,r=t({method:"get",url:a.searchUrl,params:n}),r.then(function(t){e.response=t.data}),r["catch"](function(){e.response={}}),r["finally"](function(){e.search.status="completed"})},n.bind("keyup",function(t){return 40==t.which||38==t.which?(e.updateActiveIndex(38==t.which?e.activeIndex>0?e.activeIndex-1:e.autoSuggestItemsCount-1:e.activeIndex+1<e.autoSuggestItemsCount?e.activeIndex+1:0),!1):void(13==t.which&&e.callback())})}}}])}(angular);